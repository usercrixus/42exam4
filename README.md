This is my solution for exam rank4  
It is very simple, no need comments or explaination.  
I did it in 98 lines during the exam in 45min, i'm not sure it is exactly what i pushed... anyway you have a trace for this exam.  
Good luck. Don't panic, feel free to visit me at school.